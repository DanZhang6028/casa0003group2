<!-- combo reasons for leaving housing map -->
<!DOCTYPE html>
<html>

<head>
    <!--set the basic stuff up, add the css sheet -->
    <meta charset='utf-8' />
    <title>Display a map</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
    <link href='leaving_map.css' rel='stylesheet' />

    <!-- initialize the headers and sliders for each of the maps -->

    <div id='social' class='map'></div>
    <div id='private' class='map'></div>
    <div id='divider'></div>

    <script>
            function on() {
                document.getElementById("info").style.display = "block";
            }
            function off() {
                document.getElementById("info").style.display = "none";
            }
    </script>

    <div id="infocircle">
        <div id="infotext" onclick="on()">
            i
        </div>
    </div>

    <div id="info" onclick="off()">

        <div id="infobox">
            <h1>Reasons for Lettings Map 2014-2017</h1>
            <br />
            <h3>
                <br />Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent non nulla eget nibh
                commodo molestie eget vel magna. Duis odio lacus, vulputate eget tincidunt a, placerat sit amet
                felis. Nulla facilisi. Maecenas consectetur, mauris eu porttitor malesuada, nunc dolor auctor
                tellus, sed mattis massa magna eget odio. Maecenas vitae nibh eleifend nisl rhoncus dignissim ac
                sed eros. Aliquam mauris nisi, eleifend quis mattis ac, porttitor ac sem. Proin posuere ex non
                pharetra rhoncus. Mauris vel mi dignissim, condimentum dolor blandit, pharetra ipsum.
                Suspendisse mattis mattis faucibus. Phasellus tincidunt justo ultricies, feugiat mauris vitae,
                tincidunt odio. Nullam ultrices euismod justo non varius. Morbi et nisi eu risus pellentesque
                varius porta vel ligula.
                <br />

                <h3>
                    Donec venenatis luctus nulla, non hendrerit justo porta sed. Integer bibendum ipsum non
                    eleifend
                    posuere. Aliquam ultrices quam lectus, vel tempus augue sollicitudin ut. Morbi ornare
                    ultrices
                    faucibus. Duis blandit tellus iaculis sapien facilisis rutrum. Fusce feugiat quam porttitor
                    imperdiet efficitur. Ut hendrerit mattis nisi vitae lacinia. Duis consectetur mauris et diam
                    auctor, sit amet finibus neque dapibus. Duis condimentum egestas nisi, eget vulputate nulla
                    accumsan non. Praesent faucibus dolor diam, eget suscipit ante pulvinar ut. Ut nibh quam,
                    posuere feugiat tellus sed, tempus congue dolor. Nullam condimentum finibus felis, in
                    fringilla
                    felis mollis id. Phasellus laoreet dictum nulla, non porttitor nisl blandit sed. Mauris ac
                    libero eget sem lobortis auctor et convallis arcu.
                    <br />
                </h3>
        </div>
    </div>

    <div class='map-overlay' id='features'>
        <h1>Reasons for Leaving Prior Accomodation, Socially-Owned Social Housing Residents</h1>
        <h3>Select a layer from the menu to see it visualized.
            <br> Click a borough to see the total counts and relative rate of that layer.</h3>
        <div id='pd'></div>
        <div class="map-overlay-inner">
            <h2>Year: <label id='active-year1'>2014</label></h2>
            <input id='slider1' class='slider' type='range' min='2014' max='2017' step='1' value='2014' />
            <p class="credit">&copy; Matthew Klovski 2019&nbsp;<a href="https://data.gov.uk/dataset/3832fc72-ec45-46cf-9a8f-6b4e7553dfd1/core-social-housing-lettings-la-owned-reason-for-housing">Download Dataset</a>.</p>
        </div>
    </div>


    <div class='map-overlay' id='features1'>
        <h1>Reasons for Leaving Prior Accomodation, Privately-Owned Social Housing Residents</h1>
        <h3>Select a layer from the menu to see it visualized.
                <br> Click a borough to see the total counts and relative rate of that layer.</h3>
        <div id='pd'></div>
        <div class="map-overlay-inner">
            <h2>Year: <label id='active-year2'>2014</label></h2>
            <input id='slider2' class='slider' type='range' min='2014' max='2017' step='1' value='2014' />
            <p class="credit">&copy; Matthew Klovski 2019&nbsp;<a href="https://data.gov.uk/dataset/c7d85fec-81e7-4de3-8e50-cd017bad30ef/core-social-housing-lettings-prp-owned-reason-for-housing">Download Dataset</a>.</p>
        </div>
    </div>
    <!-- dual legends and menus for each -->
    <div class='map-overlay' id='privatelegend'></div>
    <nav id="menu"></nav>
    <nav id="privatemenu"></nav>

    <!-- start the script portion -->
    <script>
        mapboxgl.accessToken = 'pk.eyJ1IjoibWtsb3Zza2kiLCJhIjoiY2l6N2R0azl2MDA1NDJ3cG9uZ2RoMzF5aiJ9.UacgAXrCVFX4BmcbH4oj_w';

        // clone map function
        function moveToMapPosition(master, clones) {
            // this makes both move at once, rather than individually
            var center = master.getCenter();
            var zoom = master.getZoom();
            var bearing = master.getBearing();
            var pitch = master.getPitch();

            clones.forEach(function (clone) {
                clone.jumpTo({
                    center: center,
                    zoom: zoom,
                    bearing: bearing,
                    pitch: pitch
                });
            });
        }

        // Sync movements of two maps (credit to Dan Zhang here)
        function syncMaps() {
            var maps;
            var argument_length = arguments.length;
            if (argument_length === 1) {
                maps = arguments[0];
            } else {
                maps = [];
                for (var i = 0; i < argument_length; i++) {
                    maps.push(arguments[i]);
                }
            }

            // again, credit to dan zhang here, continuing the logic to get them to move at once
            var fns = [];
            maps.forEach(function (map, index) {
                fns[index] = sync.bind(null, map, maps.filter(function (o, i) { return i !== index; }));
            });

            function on() {
                maps.forEach(function (map, index) {
                    map.on('move', fns[index]);
                });
            }

            function off() {
                maps.forEach(function (map, index) {
                    map.off('move', fns[index]);
                });
            }

            // toggling the listeners based on if the map is moving or not
            function sync(master, clones) {
                off();
                moveToMapPosition(master, clones);
                on();
            }
            on();
        };

        // set the two maps as either social or private
        var social = new mapboxgl.Map({
            container: 'social',
            style: 'mapbox://styles/mklovski/cjvb0602e09go1fn0zwgps0cn',
            // set the default load location
            center: [-0.131, 51.519],
            zoom: 8.9
        });

        var private = new mapboxgl.Map({
            container: 'private',
            style: 'mapbox://styles/mklovski/cjvb0602e09go1fn0zwgps0cn',
            // set the default load location
            center: [-0.131, 51.519],
            zoom: 8.9
        });

        // set maps to both maps combined
        var maps = syncMaps(social, private);


        // load the boundary layer
        social.on('load', function () {
            social.addLayer({
                id: 'gla_boundary',
                type: 'line',
                source: {
                    type: 'vector',
                    url: 'mapbox://mklovski.bjr2ut89'
                },
                'source-layer': 'gla_boundary-5dmnh1',
                'layout': {
                    'visibility': 'visible'
                },
                // style the colors
                paint: {
                    'line-color': '#000000',
                    'line-width': 2
                }
            });

            // add the multitude of leaving layers
            // adding the totals
            social.addLayer({
                id: 'social_leaving',
                type: 'fill',
                source: {
                    type: 'vector',
                    url: 'mapbox://mklovski.bww58hh3'
                },
                'source-layer': 'social_leaving-2scgtp',
                'layout': {
                    'visibility': 'none'
                },
                // style the colors
                paint: {
                    'fill-opacity': .85,
                    // color of layers based on the rate per 100k of the event
                    'fill-color': {
                        property: 'totalper100k',
                        stops: [
                            [96.84, '#fef0d9'],
                            [160.78, '#fdcc8a'],
                            [243.08, '#fc8d59'],
                            [409.41, '#e34a33'],
                            [534, '#b30000'],
                        ]
                    },
                },
                // start just showing the 2014 year for all (modified by slider)
                filter: ['==', ['number', ['get', 'year']], 2014]
            });


            social.addLayer({
                id: 'social_evict',
                type: 'fill',
                source: {
                    type: 'vector',
                    url: 'mapbox://mklovski.bww58hh3'
                },
                'source-layer': 'social_leaving-2scgtp',
                'layout': {
                    'visibility': 'none'
                },
                // style the colors
                paint: {
                    'fill-opacity': .85,
                    'fill-color': {
                        property: 'evictper100k',
                        stops: [
                            [2.238, '#fef0d9'],
                            [6.048, '#fdcc8a'],
                            [13.288, '#fc8d59'],
                            [22.195, '#e34a33'],
                            [26.808, '#b30000'],
                        ]
                    },
                },
                filter: ['==', ['number', ['get', 'year']], 2014]
            });


            social.addLayer({
                id: 'social_decant',
                type: 'fill',
                source: {
                    type: 'vector',
                    url: 'mapbox://mklovski.bww58hh3'
                },
                'source-layer': 'social_leaving-2scgtp',
                'layout': {
                    'visibility': 'none'
                },
                // style the colors
                paint: {
                    'fill-opacity': .85,
                    'fill-color': {
                        property: 'decantper100k',
                        stops: [
                            [4.065, '#fef0d9'],
                            [14.283, '#fdcc8a'],
                            [30.285, '#fc8d59'],
                            [47.978, '#e34a33'],
                            [98.131, '#b30000'],
                        ]
                    },
                },
                filter: ['==', ['number', ['get', 'year']], 2014]
            });


            social.addLayer({
                id: 'social_unafford',
                type: 'fill',
                source: {
                    type: 'vector',
                    url: 'mapbox://mklovski.bww58hh3'
                },
                'source-layer': 'social_leaving-2scgtp',
                'layout': {
                    'visibility': 'none'
                },
                // style the colors
                paint: {
                    'fill-opacity': .85,
                    'fill-color': {
                        property: 'unafford100k',
                        stops: [
                            [1.053, '#fef0d9'],
                            [2.933, '#fdcc8a'],
                            [6.462, '#fc8d59'],
                            [13.512, '#e34a33'],
                            [27.933, '#b30000'],
                        ]
                    },
                },
                filter: ['==', ['number', ['get', 'year']], 2014]
            });


            social.addLayer({
                id: 'social_condition',
                type: 'fill',
                source: {
                    type: 'vector',
                    url: 'mapbox://mklovski.bww58hh3'
                },
                'source-layer': 'social_leaving-2scgtp',
                'layout': {
                    'visibility': 'none'
                },
                // style the colors
                paint: {
                    'fill-opacity': .85,
                    'fill-color': {
                        property: 'poor_condper100k',
                        stops: [
                            [1.277, '#fef0d9'],
                            [3.683, '#fdcc8a'],
                            [7.467, '#fc8d59'],
                            [13.966, '#e34a33'],
                            [27.023, '#b30000'],
                        ]
                    },
                },
                filter: ['==', ['number', ['get', 'year']], 2014]
            });


            social.addLayer({
                id: 'social_overcrowded',
                type: 'fill',
                source: {
                    type: 'vector',
                    url: 'mapbox://mklovski.bww58hh3'
                },
                'source-layer': 'social_leaving-2scgtp',
                'layout': {
                    'visibility': 'none'
                },
                // style the colors
                paint: {
                    'fill-opacity': .85,
                    'fill-color': {
                        property: 'overcrowdper100k',
                        stops: [
                            [12.73, '#fef0d9'],
                            [31.62, '#fdcc8a'],
                            [53.49, '#fc8d59'],
                            [85.29, '#e34a33'],
                            [145.52, '#b30000'],
                        ]
                    },
                },
                filter: ['==', ['number', ['get', 'year']], 2014]
            });

            //   slider function here for the first map
            document.getElementById('slider1').addEventListener('input', function (e) {
                // set the distinct year variable for this map
                var socialyear = parseInt(e.target.value);
                // update the map for each layer
                social.setFilter('social_leaving', ['==', ['number', ['get', 'year']], socialyear]);
                social.setFilter('social_evict', ['==', ['number', ['get', 'year']], socialyear]);
                social.setFilter('social_decant', ['==', ['number', ['get', 'year']], socialyear]);
                social.setFilter('social_unafford', ['==', ['number', ['get', 'year']], socialyear]);
                social.setFilter('social_condition', ['==', ['number', ['get', 'year']], socialyear]);
                social.setFilter('social_overcrowded', ['==', ['number', ['get', 'year']], socialyear]);
                // update the text above the slider each time
                document.getElementById('active-year1').innerText = socialyear;
            });
        });

        // creating the layer selection menu, first with a changelayers variable outside of a function
        var changelayers = ['social_leaving', 'social_evict', 'social_decant', 'social_unafford', 'social_condition', 'social_overcrowded'];

        for (var i = 0; i < changelayers.length; i++) {
            var id = changelayers[i];

            var link = document.createElement('a');
            link.href = '#';
            // helps set the style for active button
            link.className = ['active', 'not-active'];
            link.textContent = id;
            link.onclick = function (e) {
                var clickedLayer = this.textContent;
                e.preventDefault();
                e.stopPropagation();
                //  setting the visibility for each layer as a variable
                var visibility = social.getLayoutProperty(clickedLayer, 'visibility');

                if (visibility === 'visible') {
                    social.setLayoutProperty(clickedLayer, 'visibility', 'none');
                    this.className = 'not-active';
                } else {
                    this.className = 'active';
                    social.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                }
            };
            // update the actual menu
            var layers = document.getElementById('menu');
            layers.appendChild(link);
        }

        // create popup when a borough is clicked
        social.on('click', 'social_leaving', function (e) {
            var socialname = e.features[0].properties.name;
            var socialyear = e.features[0].properties.year;
            var socialtotal_leaving = e.features[0].properties.total_leaving;
            var socialtotalper100k = e.features[0].properties.totalper100k;
            // format the popup
            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(socialname.bold().fontsize(4) + "<h3>" + "In " + socialyear + ", " + socialtotal_leaving + " person(s) left " + socialname + " in total" + "<br>" + socialtotalper100k.toFixed(2) + " total leavings per 100,000" + "</h3>")
                .addTo(social);
        });
        // change the icon when you hover it
        social.on('mouseenter', 'social_leaving', function () {
            social.getCanvas().style.cursor = 'pointer';
        });
        // change it back when you leave
        social.on('mouseleave', 'social_leaving', function () {
            social.getCanvas().style.cursor = '';
        });

        // repeat the above process for each layer
        social.on('click', 'social_evict', function (e) {
            var socialname = e.features[0].properties.name;
            var socialyear = e.features[0].properties.year;
            var socialtotal_evict = e.features[0].properties.evict_or_repossess;
            var socialevictper100k = e.features[0].properties.evictper100k;
            // format the popup
            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(socialname.bold().fontsize(4) + "<h3>" + "In " + socialyear + ", " + socialtotal_evict + " person(s) were evicted from " + socialname + "<br>" + socialevictper100k.toFixed(2) + " evictions per 100,000" + "</h3>")
                .addTo(social);
        });
        // change the icon when you hover it
        social.on('mouseenter', 'social_evict', function () {
            social.getCanvas().style.cursor = 'pointer';
        });
        // change it back when you leave
        social.on('mouseleave', 'social_evict', function () {
            social.getCanvas().style.cursor = '';
        });

        social.on('click', 'social_decant', function (e) {
            var socialname = e.features[0].properties.name;
            var socialyear = e.features[0].properties.year;
            var socialtotal_decant = e.features[0].properties.permanently_decanted;
            var socialdecantper100k = e.features[0].properties.decantper100k;
            // format the popup
            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(socialname.bold().fontsize(4) + "<h3>" + "In " + socialyear + ", " + socialtotal_decant + " person(s) permanently decanted from " + socialname + "<br>" + socialdecantper100k.toFixed(2) + " decantings per 100,000" + "</h3>")
                .addTo(social);
        });
        // change the icon when you hover it
        social.on('mouseenter', 'social_decant', function () {
            social.getCanvas().style.cursor = 'pointer';
        });
        // change it back when you leave
        social.on('mouseleave', 'social_decant', function () {
            social.getCanvas().style.cursor = '';
        });


        social.on('click', 'social_unafford', function (e) {
            var socialname = e.features[0].properties.name;
            var socialyear = e.features[0].properties.year;
            var socialtotal_unafford = e.features[0].properties.unaffordable;
            var socialunaffordper100k = e.features[0].properties.unafford100k;
            // format the popup
            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(socialname.bold().fontsize(4) + "<h3>" + "In " + socialyear + ", " + socialtotal_unafford + " person(s) left " + socialname + " because of unaffordable housing " + "<br>" + socialunaffordper100k.toFixed(2) + " people per 100,000" + "</h3>")
                .addTo(social);
        });
        // change the icon when you hover it
        social.on('mouseenter', 'social_unafford', function () {
            social.getCanvas().style.cursor = 'pointer';
        });
        // change it back when you leave
        social.on('mouseleave', 'social_unafford', function () {
            social.getCanvas().style.cursor = '';
        });


        social.on('click', 'social_condition', function (e) {
            var socialname = e.features[0].properties.name;
            var socialyear = e.features[0].properties.year;
            var socialtotal_condition = e.features[0].properties.poor_condition;
            var socialconditionper100k = e.features[0].properties.poor_condper100k;
            // format the popup
            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(socialname.bold().fontsize(4) + "<h3>" + "In " + socialyear + ", " + socialtotal_condition + " person(s) left " + socialname + " because of poor home condition " + "<br>" + socialconditionper100k.toFixed(2) + " people per 100,000" + "</h3>")
                .addTo(social);
        });
        // change the icon when you hover it
        social.on('mouseenter', 'social_condition', function () {
            social.getCanvas().style.cursor = 'pointer';
        });
        // change it back when you leave
        social.on('mouseleave', 'social_condition', function () {
            social.getCanvas().style.cursor = '';
        });



        social.on('click', 'social_overcrowded', function (e) {
            var socialname = e.features[0].properties.name;
            var socialyear = e.features[0].properties.year;
            var socialtotal_over = e.features[0].properties.overcrowded;
            var socialovercrow100k = e.features[0].properties.overcrowdper100k;
            // format the popup
            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(socialname.bold().fontsize(4) + "<h3>" + "In " + socialyear + ", " + socialtotal_over + " person(s) left " + socialname + " because of overcrowding " + "<br>" + socialovercrow100k.toFixed(2) + " people per 100,000" + "</h3>")
                .addTo(social);
        });
        // change the icon when you hover it
        social.on('mouseenter', 'social_overcrowded', function () {
            social.getCanvas().style.cursor = 'pointer';
        });
        // change it back when you leave
        social.on('mouseleave', 'social_overcrowded', function () {
            social.getCanvas().style.cursor = '';
        });

        // all of the above repeated again for the privately owned housing map!!!

        private.on('load', function () {

            private.addLayer({
                id: 'gla_boundary',
                type: 'line',
                source: {
                    type: 'vector',
                    url: 'mapbox://mklovski.bjr2ut89'
                },
                'source-layer': 'gla_boundary-5dmnh1',
                'layout': {
                    'visibility': 'visible'
                },
                // style the colors
                paint: {
                    'line-color': '#000000',
                    'line-width': 2
                }
            });

            // adding the totals
            private.addLayer({
                id: 'private_leaving',
                type: 'fill',
                source: {
                    type: 'vector',
                    url: 'mapbox://mklovski.c21q08eu'
                },
                'source-layer': 'private_leaving-0mzusp',
                'layout': {
                    'visibility': 'none'
                },
                // style the colors
                paint: {
                    'fill-opacity': .85,
                    'fill-color': {
                        property: 'totalper100k',
                        stops: [
                            [49.5, '#fef0d9'],
                            [95.65, '#fdcc8a'],
                            [146.11, '#fc8d59'],
                            [229.48, '#e34a33'],
                            [374.76, '#b30000'],
                        ]
                    },
                },
                filter: ['==', ['number', ['get', 'year']], 2014]
            });

            // adding the totals
            private.addLayer({
                id: 'private_evict',
                type: 'fill',
                source: {
                    type: 'vector',
                    url: 'mapbox://mklovski.c21q08eu'
                },
                'source-layer': 'private_leaving-0mzusp',
                'layout': {
                    'visibility': 'none'
                },
                // style the colors
                paint: {
                    'fill-opacity': .85,
                    'fill-color': {
                        property: 'evictper100k',
                        stops: [
                            [.6703, '#fef0d9'],
                            [1.553, '#fdcc8a'],
                            [3.0792, '#fc8d59'],
                            [6.6034, '#e34a33'],
                            [10.9041, '#b30000'],
                        ]
                    },
                },
                filter: ['==', ['number', ['get', 'year']], 2014]
            });

            private.addLayer({
                id: 'private_decant',
                type: 'fill',
                source: {
                    type: 'vector',
                    url: 'mapbox://mklovski.c21q08eu'
                },
                'source-layer': 'private_leaving-0mzusp',
                'layout': {
                    'visibility': 'none'
                },
                // style the colors
                paint: {
                    'fill-opacity': .85,
                    'fill-color': {
                        property: 'decantper100k',
                        stops: [
                            [4.028, '#fef0d9'],
                            [13.699, '#fdcc8a'],
                            [28.148, '#fc8d59'],
                            [45.341, '#e34a33'],
                            [67.809, '#b30000'],
                        ]
                    },
                },
                filter: ['==', ['number', ['get', 'year']], 2014]
            });

            private.addLayer({
                id: 'private_unafford',
                type: 'fill',
                source: {
                    type: 'vector',
                    url: 'mapbox://mklovski.c21q08eu'
                },
                'source-layer': 'private_leaving-0mzusp',
                'layout': {
                    'visibility': 'none'
                },
                // style the colors
                paint: {
                    'fill-opacity': .85,
                    'fill-color': {
                        property: 'unaffordper100k',
                        stops: [
                            [0, '#fef0d9'],
                            [0.6703, '#fdcc8a'],
                            [1.3427, '#fc8d59'],
                            [2.1555, '#e34a33'],
                            [3.8639, '#b30000'],
                        ]
                    },
                },
                filter: ['==', ['number', ['get', 'year']], 2014]
            });

            private.addLayer({
                id: 'private_condition',
                type: 'fill',
                source: {
                    type: 'vector',
                    url: 'mapbox://mklovski.c21q08eu'
                },
                'source-layer': 'private_leaving-0mzusp',
                'layout': {
                    'visibility': 'none'
                },
                // style the colors
                paint: {
                    'fill-opacity': .85,
                    'fill-color': {
                        property: 'poor_condper100k',
                        stops: [
                            [5.4, '#fef0d9'],
                            [10.8, '#fdcc8a'],
                            [16.2, '#fc8d59'],
                            [21.6, '#e34a33'],
                            [27.0234, '#b30000'],
                        ]
                    },
                },
                filter: ['==', ['number', ['get', 'year']], 2014]
            });

            private.addLayer({
                id: 'private_overcrowded',
                type: 'fill',
                source: {
                    type: 'vector',
                    url: 'mapbox://mklovski.c21q08eu'
                },
                'source-layer': 'private_leaving-0mzusp',
                'layout': {
                    'visibility': 'none'
                },
                // style the colors
                paint: {
                    'fill-opacity': .85,
                    'fill-color': {
                        property: 'overcrowdper100k',
                        stops: [
                            [1.277, '#fef0d9'],
                            [3.162, '#fdcc8a'],
                            [5.841, '#fc8d59'],
                            [10.255, '#e34a33'],
                            [27.198, '#b30000'],
                        ]
                    },
                },
                filter: ['==', ['number', ['get', 'year']], 2014]
            });

            document.getElementById('slider2').addEventListener('input', function (e) {
                var privateyear = parseInt(e.target.value);
                // update the map
                private.setFilter('private_leaving', ['==', ['number', ['get', 'year']], privateyear]);
                private.setFilter('private_evict', ['==', ['number', ['get', 'year']], privateyear]);
                private.setFilter('private_decant', ['==', ['number', ['get', 'year']], privateyear]);
                private.setFilter('private_unafford', ['==', ['number', ['get', 'year']], privateyear]);
                private.setFilter('private_condition', ['==', ['number', ['get', 'year']], privateyear]);
                private.setFilter('private_overcrowded', ['==', ['number', ['get', 'year']], privateyear]);
                // update text in the UI
                document.getElementById('active-year2').innerText = privateyear;
            });
        });

        var changelayers = ['private_leaving', 'private_evict', 'private_decant', 'private_unafford', 'private_condition', 'private_overcrowded'];

        for (var i = 0; i < changelayers.length; i++) {
            var id = changelayers[i];

            var link = document.createElement('a');
            link.href = '#';
            link.className = ['active', 'not-active'];
            link.textContent = id;
            link.onclick = function (e) {
                var clickedLayer = this.textContent;
                e.preventDefault();
                e.stopPropagation();

                var visibility = private.getLayoutProperty(clickedLayer, 'visibility');

                if (visibility === 'visible') {
                    private.setLayoutProperty(clickedLayer, 'visibility', 'none');
                    this.className = 'not-active';
                } else {
                    this.className = 'active';
                    private.setLayoutProperty(clickedLayer, 'visibility', 'visible');
                }
            };

            var layers = document.getElementById('privatemenu');
            layers.appendChild(link);
        }
        private.on('click', 'private_leaving', function (e) {
            var privatename = e.features[0].properties.name;
            var privateyear = e.features[0].properties.year;
            var privatetotal_leaving = e.features[0].properties.total_leaving;
            var privatetotalper100k = e.features[0].properties.totalper100k;
            // format the popup
            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(privatename.bold().fontsize(4) + "<h3>" + "In " + privateyear + ", " + privatetotal_leaving + " person(s) left " + privatename + " in total " + "<br>" + privatetotalper100k.toFixed(2) + " people per 100,000" + "</h3>")
                .addTo(private);
        });
        // change the icon when you hover it
        private.on('mouseenter', 'private_leaving', function () {
            private.getCanvas().style.cursor = 'pointer';
        });
        // change it back when you leave
        private.on('mouseleave', 'private_leaving', function () {
            private.getCanvas().style.cursor = '';
        });


        private.on('click', 'private_evict', function (e) {
            var privatename = e.features[0].properties.name;
            var privateyear = e.features[0].properties.year;
            var privatetotal_evict = e.features[0].properties.evict_or_repossess;
            var privateevictper100k = e.features[0].properties.evictper100k;
            // format the popup
            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(privatename.bold().fontsize(4) + "<h3>" + "In " + privateyear + ", " + privatetotal_evict + " person(s) were evicted from " + privatename + "<br>" + privateevictper100k.toFixed(2) + " people per 100,000" + "</h3>")
                .addTo(private);
        });
        // change the icon when you hover it
        private.on('mouseenter', 'private_evict', function () {
            private.getCanvas().style.cursor = 'pointer';
        });
        // change it back when you leave
        private.on('mouseleave', 'private_evict', function () {
            private.getCanvas().style.cursor = '';
        });

        private.on('click', 'private_decant', function (e) {
            var privatename = e.features[0].properties.name;
            var privateyear = e.features[0].properties.year;
            var privatetotal_decant = e.features[0].properties.permanently_decanted;
            var privatedecantper100k = e.features[0].properties.decantper100k;
            // format the popup
            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(privatename.bold().fontsize(4) + "<h3>" + "In " + privateyear + ", " + privatetotal_decant + " person(s) permanently decanted from " + privatename + "<br>" + privatedecantper100k.toFixed(2) + " people per 100,000" + "</h3>")
                .addTo(private);
        });
        // change the icon when you hover it
        private.on('mouseenter', 'private_decant', function () {
            private.getCanvas().style.cursor = 'pointer';
        });
        // change it back when you leave
        private.on('mouseleave', 'private_decant', function () {
            private.getCanvas().style.cursor = '';
        });


        private.on('click', 'private_unafford', function (e) {
            var privatename = e.features[0].properties.name;
            var privateyear = e.features[0].properties.year;
            var privatetotal_unafford = e.features[0].properties.unaffordable;
            var privateunaffordper100k = e.features[0].properties.unaffordper100k;
            // format the popup
            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(privatename.bold().fontsize(4) + "<h3>" + "In " + privateyear + ", " + privatetotal_unafford + " person(s) left " + privatename + " because of unaffordable housing " + "<br>" + privateunaffordper100k.toFixed(2) + " people per 100,000" + "</h3>")
                .addTo(private);
        });
        // change the icon when you hover it
        private.on('mouseenter', 'private_unafford', function () {
            private.getCanvas().style.cursor = 'pointer';
        });
        // change it back when you leave
        private.on('mouseleave', 'private_unafford', function () {
            private.getCanvas().style.cursor = '';
        });

        private.on('click', 'private_condition', function (e) {
            var privatename = e.features[0].properties.name;
            var privateyear = e.features[0].properties.year;
            var privatetotal_cond = e.features[0].properties.poor_condition;
            var privatepoor_condper100k = e.features[0].properties.poor_condper100k;
            // format the popup
            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(privatename.bold().fontsize(4) + "<h3>" + "In " + privateyear + ", " + privatetotal_cond + " person(s) left " + privatename + " because of poor housing conditions " + "<br>" + privatepoor_condper100k.toFixed(2) + " people per 100,000" + "</h3>")
                .addTo(private);
        });
        // change the icon when you hover it
        private.on('mouseenter', 'private_condition', function () {
            private.getCanvas().style.cursor = 'pointer';
        });
        // change it back when you leave
        private.on('mouseleave', 'private_condition', function () {
            private.getCanvas().style.cursor = '';
        });

        private.on('click', 'private_overcrowded', function (e) {
            var privatename = e.features[0].properties.name;
            var privateyear = e.features[0].properties.year;
            var privatetotal_over = e.features[0].properties.overcrowded;
            var privateovercrow100k = e.features[0].properties.overcrowdper100k;
            // format the popup
            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(privatename.bold().fontsize(4) + "<h3>" + "In " + privateyear + ", " + privatetotal_over + " person(s) left " + privatename + " because of overcrowding " + "<br>" + privateovercrow100k.toFixed(2) + " people per 100,000" + "</h3>")
                .addTo(private);
        });
        // change the icon when you hover it
        private.on('mouseenter', 'private_overcrowded', function () {
            private.getCanvas().style.cursor = 'pointer';
        });
        // change it back when you leave
        private.on('mouseleave', 'private_overcrowded', function () {
            private.getCanvas().style.cursor = '';
        });

        // add a legend for the private housing map
        var privatelegendlabels = ['Very Low', 'Low', 'Middle', 'High', 'Very High'];
        var privatecolors = ['#fef0d9', '#fdcc8a', '#fc8d59', '#e34a33', '#b30000'];
        for (i = 0; i < privatelegendlabels.length; i++) {
            var privatelayer = privatelegendlabels[i];
            var privatecolor = privatecolors[i];
            var privateitem = document.createElement('div');
            var privatekey = document.createElement('span');
            privatekey.className = 'privatelegend-key';
            privatekey.style.backgroundColor = privatecolor;

            var privatevalue = document.createElement('span');
            privatevalue.innerHTML = privatelayer;
            privateitem.appendChild(privatekey);
            privateitem.appendChild(privatevalue);
            privatelegend.appendChild(privateitem);
        }

    </script>

    </body>

</html>