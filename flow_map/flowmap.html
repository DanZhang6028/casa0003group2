    <!DOCTYPE html>
    <html>
    <head>
      <meta charset='utf-8' />
      <title>London Flowmap</title>
      <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
      <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>

      <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet' />
        
      <link rel="stylesheet" href="stylesheet.css" />

      
    <script>
        function on() {
            document.getElementById("info").style.display = "block";
        }
        function off() {
            document.getElementById("info").style.display = "none";
        }
</script>

<div id="infocircle">
    <div id="infotext" onclick="on()">
        i
    </div>
</div>

<div id="info" onclick="off()">

    <div id="infobox">
        <h1>3. Population inflow and outflow between London and the UK</h1>
        <br />
        <h3>
            <br />This dual map visualizes the internal inflow and outflow of migration in London from 2012 to 2017. The initial view shows the inflow and outflow relationship between London and the rest of the UK. However, you can also zoom into London to reveal an inflow and outflow choropleth map specific to the London boroughs. This duality between the detailed flow lines and point map in the higher zoom levels, and the London boroughs showing the areas of greatest change in the lower, allows for two different datasets to compliment each other. The visualisation allows us a look at both volume of traffic and direction in one seamless interface.
            <br />
            <br />
            <h3>
            When we look at the changes of inflows and outflows over years we can seen that there has been an increase in both inflows and outflows in almost all of the boroughs, and the increase of outflow over six years is higher than inflow. If we look it in detail, we notice that Wandsworth and Lambeth boroughs had the highest population churn in both inflows and outflows over 6 years, followed by Southwark. And the city of London had the lowest migration flows among all boroughs in London.
            <br />
        <h3>

    </div>
</div>

    </head>
    <body>

    <div id='inflow' class='map'>

    </div>
        

        
    <div id='inflow-legend' class='legend'>
      <h4>Inflow Population</h4>
      <div><span style='background-color: #f7fafa'></span>0</div>
      <div><span style='background-color: #edf3f3'></span>1000</div>
      <div><span style='background-color: #afc9ca'></span>100000</div>
      <div><span style='background-color: #729fa2'></span>20000</div>
      <div><span style='background-color: #456769'></span>30000</div>
      <div><span style='background-color: #1d2b2c'></span>40000</div>
    </div>

    <div id='outflow-legend' class='legend1'>
      <h4>Outflow Population</h4>
      <div><span style='background-color: #e9dbc0'></span>0</div>
      <div><span style='background-color: #ceb075'></span>1000</div>
      <div><span style='background-color: #a3803a'></span>100000</div>
      <div><span style='background-color: #715928'></span>20000</div>
      <div><span style='background-color: #3f3116'></span>30000</div>
      <div><span style='background-color: #0d0a05'></span>40000</div>
    </div>

    <div id='netflow-legend' class='legend2'>
            <h4>Netflow Population</h4>
            <div><span style='background-color: #b2182b'></span>-10000</div>
            <div><span style='background-color: #ef8a62'></span>-6000</div>
            <div><span style='background-color: #fddbc7'></span>-4000</div>
            <div><span style='background-color: #d1e5f0'></span>0</div>
            <div><span style='background-color: #67a9cf'></span>2000</div>
            <div><span style='background-color: #2166ac'></span>3000</div>
            </div>

    <div id='outflow' class='map'>
    </div>
    <div id='divider'></div>
    <div class='map-overlay' id='features'><h1>London Inflow</h1><div id='pd'><h2>Hover over a line or point!</h2></div>
        
    
    <div class="map-overlay-inner" id = 'inflowoverlay'>
     <h2>Year: <label id='year'>2012</label></h2>
     <table><tr><td>
      <input id='slider1' class="slider" type='range' min='0' max='5' step='1' value='0' list='tickmarks' />
      <datalist id="tickmarks">
        <option value="0" label="2012">
          <option value="1">
            <option value="2">
              <option value="3">
                <option value="4" label="2016">
                  <option value="5" label="2017">
                  </datalist>
                </td>
              </tr></table> 
        
            </div>
          
        <div id = 'flowmapyear'><h2>Year: 2017</h2></div>
        <div id = "credit"> <br><p>&copy;Dan Zhang 2019&nbsp;<a href="https://www.ons.gov.uk/peoplepopulationandcommunity/populationandmigration/migrationwithintheuk/datasets/internalmigrationbyoriginanddestinationlocalauthoritiessexandsingleyearofagedetailedestimatesdataset" target="_blank">Office for National Statistics</a></p></div>
          </div>


        <button id = 'button'>Net Flows</button>
        <button id = 'flybutton'>Flow Map</button>
        
        <button id = 'chorobutton'>London Borough</button>
        
          <div class='map-overlay' id='features1'><h1>London Outflow</h1><div id='ph'><h2>Hover over a line or point!</h2></div>
          <div id = 'flowmapyear2'><h2>Year: 2017</h2></div>
                </div>

        
        
        <div class='map-overlay-net' id='features2'><h1>London Netflow</h1><div id='pz'><p>Hover over a line or point!</p></div>
        <div class="map-overlay-inner">
           <h2> Year: <label id='year3'>2012</label></h2>
           <table><tr><td>
            <input id='slider3' class="slider" type='range' min='0' max='5' step='1' value='0' list='tickmarks' />
            <datalist id="tickmarks">
              <option value="0" label="2012">
                <option value="1">
                  <option value="2">
                    <option value="3">
                      <option value="4" label="2016">
                        <option value="5" label="2017">
                        </datalist>
                      </td>
                    </tr></table> 
                  </div>
            
            
            

                <script>
                  mapboxgl.accessToken = 'pk.eyJ1IjoiZGFuemhhbmc2MDI4IiwiYSI6ImNqbnl3cjA3NDAxa2Iza21xNTh0ZHJmanEifQ.-f1bD67sihexMWPoxNjZbw';

// credit to David Clark for this next bit here, https://github.com/mapbox/mapbox-gl-sync-move
                  function moveToMapPosition (master, clones) {
                    var center = master.getCenter();
                    var zoom = master.getZoom();
                    var bearing = master.getBearing();
                    var pitch = master.getPitch();

                    clones.forEach(function (clone) {
                      clone.jumpTo({
                        center: center,
                        zoom: zoom,
                        bearing: bearing,
                        pitch: pitch
                      });
                    });
                  }

    // Sync movements of two maps.
    //
    // All interactions that result in movement end up firing
    // a "move" event. The trick here, though, is to
    // ensure that movements don't cycle from one map
    // to the other and back again, because such a cycle
    // - could cause an infinite loop
    // - prematurely halts prolonged movements like
    //   double-click zooming, box-zooming, and flying
    function syncMaps () {
      var maps;
      var argLen = arguments.length;
      if (argLen === 1) {
        maps = arguments[0];
      } else {
        maps = [];
        for (var i = 0; i < argLen; i++) {
          maps.push(arguments[i]);
        }
      }

      // Create all the movement functions, because if they're created every time
      // they wouldn't be the same and couldn't be removed.
      var fns = [];
      maps.forEach(function (map, index) {
        fns[index] = sync.bind(null, map, maps.filter(function (o, i) { return i !== index; }));
      });

      function on () {
        maps.forEach(function (map, index) {
          map.on('move', fns[index]);
        });
      }

      function off () {
        maps.forEach(function (map, index) {
          map.off('move', fns[index]);
        });
      }
      
// credit to David Clark for this next bit here, https://github.com/mapbox/mapbox-gl-sync-move
      // When one map moves, we turn off the movement listeners
      // on all the maps, move it, then turn the listeners on again
      function sync (master, clones) {
        off();
        moveToMapPosition(master, clones);
        on();
      }

      on();
    }

    //module.exports = syncMaps;


    var inflowmap = new mapboxgl.Map({
      container: 'inflow',
      style: 'mapbox://styles/danzhang6028/cjvcojym61a1p1fp0aqsr5pk8',
      center: [-0.904133,54.060395],
      zoom: 5.28
    });
    //mapbox://styles/danzhang6028/cjv3vh8a00wd01foijlgt2myv
    //mapbox://styles/danzhang6028/cjv3y5p9e0fkj1frme5lbjfed

    var outflowmap = new mapboxgl.Map({
      container: 'outflow',
      style: 'mapbox://styles/danzhang6028/cjvcojym61a1p1fp0aqsr5pk8',
      center: [-0.904133,54.060395],
      zoom: 5.28
    });
                    
    // sync maps
    var mapp = syncMaps(inflowmap, outflowmap);

    var zoomThreshold = 8.5;
    
    // fly zooms added
                    
    //fly to flow map          
    document.getElementById('flybutton').addEventListener('click', function () {
   
       inflowmap.flyTo({
            center: [
                -0.904133,
                54.060395],
                zoom: 5.28,
                bearing: 0
            });
        });   
    // fly to choropleth map   
    document.getElementById('chorobutton').addEventListener('click', function () {
   
       inflowmap.flyTo({
            center: [
                -0.131404, 51.570888],
                zoom: 8.6,
                bearing: 0
            });
        }); 
       
    // load inflow map functions
    inflowmap.on('load', function() {

      var years = ['12','13','14','15','16','17']


      // function for inflow slider
        function setYear(year) {
                    // Set the label to the correct year
                    document.getElementById('year').textContent = years[year];

                    var pp = inflowmap.getPaintProperty('InflowMapLayer','fill-color');

                    console.log(pp);
                    pp.property = "inflow_" + years[year];

                    inflowmap.setPaintProperty('InflowMapLayer','fill-color',pp);

                    console.log(inflowmap.getPaintProperty('InflowMapLayer','fill-color'));

                    inflowmap.setLayoutProperty('InflowMapLayer', 'visibility', 'none');
                    inflowmap.setLayoutProperty('InflowMapLayer', 'visibility', 'visible');  
                  }

        // function for netflow slider 
        function netsetYear(year) {
                    // Set the label to the correct year
                    document.getElementById('year3').textContent = years[year];

                    var pp = inflowmap.getPaintProperty('netflowLayer','fill-color');

                    console.log(pp);
                    pp.property = "net_" + years[year];

                    inflowmap.setPaintProperty('netflowLayer','fill-color',pp);

                    console.log(inflowmap.getPaintProperty('netflowLayer','fill-color'));

                    inflowmap.setLayoutProperty('netflowLayer', 'visibility', 'none');
                    inflowmap.setLayoutProperty('netflowLayer', 'visibility', 'visible');  
                  }

        // add inflow layer
                  inflowmap.addLayer({
                    id: 'InflowMapLayer',
                    type: 'fill',
                    source: {
                      type: 'vector',
                url: 'mapbox://danzhang6028.9ok9uwzo' // Your Mapbox tileset Map ID
              },
              'source-layer': 'allyear_inoutflow-7ttqnz',
              'minzoom':zoomThreshold,
              'layout': {
                'visibility': 'visible'
              },
              paint: {
                'fill-color': {
                  property: 'inflow_12',
                  stops:[
                  [0, '#f7fafa'],
                  [1000, '#edf3f3'],
                  [10000, '#afc9ca'],
                  [20000, '#729fa2'],
                  [30000, '#456769'],
                  [40000, '#1d2b2c'],]},
                  'fill-opacity': 1}
                },'settlement-label');


                  inflowmap.addLayer({
                    id: 'inflow-border',
                    type: 'line',
                    source: {
                      type: 'vector',
                url: 'mapbox://danzhang6028.9p6p3l55' // Your Mapbox tileset Map ID
              },
            'source-layer': 'inflow_2017-a8wu8h', // name of tilesets
            'layout': {},
            'paint': {
              "line-color": "white",
              "line-width": 1
            }
          });

        //load netflow map
                 inflowmap.addLayer({
                    id: 'netflowLayer',
                    type: 'fill',
                    source: {
                      type: 'vector',
                url: 'mapbox://danzhang6028.9ok9uwzo' // Your Mapbox tileset Map ID
              },
              'source-layer': 'allyear_inoutflow-7ttqnz',
              'minzoom':zoomThreshold,
              'layout': {
                'visibility': 'none'
              },
              paint: {
                'fill-color': {
                  property: 'net_12',
                  stops:[
                  [-10000, '#b2182b'],
                  [-6000, '#ef8a62'],
                  [-4000, '#fddbc7'],
                  [0, '#d1e5f0'],
                  [2000, '#67a9cf'],
                  [3000, '#2166ac'],]},
                  'fill-opacity': 1}
                },'settlement-label');



        //inflow map
        inflowmap.addLayer({
          'id':'inflowline',
          'type':'line',
          'source':{
            'type': 'vector',
            'url':'mapbox://danzhang6028.0xz622oe' 
          },
          'source-layer':'inflow_lines_top10-3pemmq',
          'maxzoom':zoomThreshold,
          'layout': {
            'visibility': 'visible'
          },
          'paint':{
            'line-opacity':0.30,
            'line-color': '#8fd6e6',
            'line-width':{
              property:'summed_mov',
              stops:[
              [5, 1],
              [206, 2],
              [408, 5],
              [810.945,10],]
            }  
          },
        });

        inflowmap.addLayer({
          id: 'inflow_destination',
          type: 'circle',
          source: {
            type: 'vector',
                      url: 'mapbox://danzhang6028.aswbk2r2' // Your Mapbox tileset Map ID
                    },
                    'source-layer': 'inflow_Rank10_des-9htdz0', // name of tilesets
                    'maxzoom':zoomThreshold,
                    'layout': {
                      'visibility': 'visible'
                    },
                    paint: {
                      'circle-color': 'white',
                      'circle-opacity': 1,
                      'circle-radius': {
                        'base': 6,
                        'stops': [[0, 2], [8,5]]
                      }
                    }    
                  });


        inflowmap.addLayer({
          id: 'inflow_origination',
          type: 'circle',
          source: {
            type: 'vector',
                      url: 'mapbox://danzhang6028.8yuzjqeh' // Your Mapbox tileset Map ID
                    },
                    'source-layer': 'INFLOW_DESTINATION_MOVES-d65r3p', // name of tilesets
                    'maxzoom':zoomThreshold,
                    'layout': {
                      'visibility': 'visible'
                    },
                    paint: {
                      'circle-color': "#fbf88d",
                      'circle-opacity': 0.7,
                      'circle-radius': {
                            property: 'summed_mov',// add "1960" year data to the map
                            type:'exponential',
                            'stops': [[5, 2], [4695, 10]]
                          }
                        }    
                      });




        inflowmap.addLayer({
         id: 'inflow-border1',
         type: 'line',
         source: {
          type: 'vector',
                    url: 'mapbox://danzhang6028.9p6p3l55' // Your Mapbox tileset Map ID
                  },

              'source-layer': 'inflow_2017-a8wu8h', // name of tilesets
              'maxzoom':zoomThreshold,
              'layout': {},
              'paint': {
                'line-opacity':0.8,
                "line-color": "white",
                "line-width": 0.5
              }
            });


        // show legend based on zoom level
        var inflowLegendEl = document.getElementById('inflow-legend');
        inflowmap.on('zoom', function() {
          if (inflowmap.getZoom() > zoomThreshold) {
            inflowLegendEl.style.display = 'block';
          } else {
            inflowLegendEl.style.display = 'none';
          }
        });

        // ADD POPUP WINDOW 
        // origination popup window 
        var mypopup = new mapboxgl.Popup({closeButton: false}); 

        inflowmap.on('mouseover', 'inflow_origination', function (e) {
          mypopup
          .setLngLat(e.features[0].geometry.coordinates)
          .setHTML("<h2>" + e.features[0].properties.outflow_na + "</h2><p>"+'Total Outflows: '
           +e.features[0].properties.summed_mov +'</p>' 
                                    ).addTo(inflowmap); // add table on popup box
        });
        inflowmap.on('mouseenter', 'inflow_origination', function () {
          inflowmap.getCanvas().style.cursor = 'pointer';
        });

                // Change it back to a pointer when it leaves and remove the popup window.
                inflowmap.on('mouseleave', 'inflow_origination', function () {
                  inflowmap.getCanvas().style.cursor = '';
                  mypopup.remove();
                });


        // destination popup window
        inflowmap.on('mouseover', 'inflow_destination', function (e) {
          mypopup
          .setLngLat(e.features[0].geometry.coordinates)
          .setHTML("<h2>" + e.features[0].properties.inflow_nam + "</h2>" + "<table id = 'tablepop'><tr><th class = 'title'>Origin Rank</th><th>Rank1</th><th>Rank2</th><th>Rank3</th></tr><tr class = 'rate'><td class = 'title'>LA Name</td><td>"+ e.features[0].properties['Rank1_name'] + "</td><td>" +e.features[0].properties['Rank2_name'] +"</td><td>" +e.features[0].properties['Rank3_name'] +"</td></tr><tr class = 'moves'><td class = 'title'>LA Moves</td><td>"+ e.features[0].properties['Rank1_move'] + "</td><td>" +e.features[0].properties['Rank2_move'] +"</td><td>" +e.features[0].properties['Rank3_move'] + "</td></tr></table>"
                                    ).addTo(inflowmap); // add table on popup box
        });


        inflowmap.on('mouseenter', 'inflow_destination', function () {
          inflowmap.getCanvas().style.cursor = 'pointer';
        });

                // Change it back to a pointer when it leaves and remove the popup window.
                inflowmap.on('mouseleave', 'inflow_destination', function () {
                  inflowmap.getCanvas().style.cursor = '';
                  mypopup.remove();
                });

        //add the choropleth map information
        inflowmap.on('mousemove','inflowline', function(e) {
          var features = e.features

          if (features.length > 0) {
            document.getElementById('pd').innerHTML = '<h2>' + features[0].properties.outflow_na + '</h2><h3>to</h3>' + '<h2>'+ features[0].properties.inflow_nam +'</h2><p><strong><em>' +features[0].properties.summed_mov +'</strong> moves </em></p>';
          } else {
            document.getElementById('pd').innerHTML = '<p>Hover over a line!</p>';
          }


        });



        //end of inflow map

        // inflow information on title
        inflowmap.on('mousemove',"InflowMapLayer",function(e) {
          var infl = e.features
          if (infl.length > 0) {
           document.getElementById('pd').innerHTML = '<h2><strong>' + infl[0].properties.la_name + '</strong></h2><h3><strong><em>' + infl[0].properties.inflow_12 + '</strong> people came in 2012</br><strong>' + infl[0].properties.inflow_13 + '</strong> people came in 2013</br><strong>'+ infl[0].properties.inflow_14 +'</strong> people came in 2014</br><strong>'+ infl[0].properties.inflow_15 +'</strong> people came in 2015</br><strong>'+ infl[0].properties.inflow_16 +'</strong> people came in 2016</br><strong>'+ infl[0].properties.inflow_17 +'</strong> people came in 2017</br><strong></em></h3>';
         } else {
          document.getElementById('pd').innerHTML = '<p>Hover over a borough!</p>';
        }
            //show border        
            inflowmap.setFilter("inflow-border", ["==", "la_name", infl[0].properties.la_name]);


          });
        document.getElementById('slider1').addEventListener('input', function(e) {
          var year = parseInt(e.target.value);
          setYear(year);
        });

        // click to show net flow layer

        var link = document.getElementById('button');

        link.onclick = function (e) {

        var clickedLayer = 'netflowLayer';
        e.preventDefault();
        e.stopPropagation();

        var visibility = inflowmap.getLayoutProperty(clickedLayer, 'visibility');

        if (visibility === 'visible') {
            inflowmap.setLayoutProperty(clickedLayer, 'visibility', 'none');
            this.className = '';
        } else {
            this.className = 'active';
            inflowmap.setLayoutProperty(clickedLayer, 'visibility', 'visible');
        };
            // show and hide netflow titles 
            var x = document.getElementById("features2");
        if (x.style.display === "none" || x.style.display === "") {
            x.style.display = "block";
        } else {
            x.style.display = "none";
        };

            // show and hide netflow legend

            var y = document.getElementById("netflow-legend");
        if (y.style.display === "none" || y.style.display === "") {
            y.style.display = "block";
        } else {
            y.style.display = "none";
        }


        };

        // show netflow infoemation on title window

        inflowmap.on('mousemove',"netflowLayer",function(e) {
          if (e.features.length > 0) {
           document.getElementById('pz').innerHTML = '<h2><strong>' + e.features[0].properties.la_name + '</strong></h2><h3><strong><em>' + e.features[0].properties.net_12 + '</strong> net flows in 2012</br><strong>' + e.features[0].properties.net_13 + '</strong> net flows in 2013</br><strong>'+ e.features[0].properties.net_14 +'</strong> net flows in 2014</br><strong>'+ e.features[0].properties.net_15 +'</strong> net flows in 2015</br><strong>'+ e.features[0].properties.net_16 +'</strong> net flows in 2016</br><strong>'+ e.features[0].properties.net_17 +'</strong> net flows in 2017</br><strong></em></h3>';
         } else {
          document.getElementById('pz').innerHTML = '<p>Hover over a borough!</p>';
        }
            //show border        
            inflowmap.setFilter("inflow-border", ["==", "la_name", e.features[0].properties.la_name]);

            // add time slider event
            document.getElementById('slider3').addEventListener('input', function(e) {
          var year = parseInt(e.target.value);
          netsetYear(year);
        });

          });

         // show botton based on zoom level
        var buttonEl = document.getElementById('button');
        inflowmap.on('zoom', function() {
          if (inflowmap.getZoom() > zoomThreshold) {
            buttonEl.style.display = 'block';
          } else {
            buttonEl.style.display = 'none';
          }
        });

        // show year window based on zoom level
        var sliderEl = document.getElementById('inflowoverlay');
        inflowmap.on('zoom', function() {
          if (inflowmap.getZoom() > zoomThreshold) {
            sliderEl.style.display = 'block';
          } else {
            sliderEl.style.display = 'none';
          }
        });
        
        // show inflow and outflow slider based on zoom level
        var slider1El = document.getElementById('slider1');
        inflowmap.on('zoom', function() {
          if (inflowmap.getZoom() > zoomThreshold) {
            slider1El.style.display = 'block';
          } else {
            slider1El.style.display = 'none';
          }
        });
        
        // show netflow slider based on zoom level
        var slider3El = document.getElementById('slider3');
        inflowmap.on('zoom', function() {
          if (inflowmap.getZoom() > zoomThreshold) {
            slider3El.style.display = 'block';
          } else {
            slider3El.style.display = 'none';
          }
        });
        
        // show flowmap year based on zoom level
        var flowmapyearEl = document.getElementById('flowmapyear');
        inflowmap.on('zoom', function() {
          if (inflowmap.getZoom() > zoomThreshold) {
            flowmapyearEl.style.display = 'none';
          } else {
            flowmapyearEl.style.display = 'block';
          }
        });
        
        // show flowmap button based on zoon level
        var flowmapbuttonEl = document.getElementById('flybutton');
        inflowmap.on('zoom', function() {
          if (inflowmap.getZoom() > zoomThreshold) {
            flowmapbuttonEl.style.display = 'block';
          } else {
            flowmapbuttonEl.style.display = 'none';
          }
        });
        
        // show choropleth map button based on zoon level
        var chorobuttonEl = document.getElementById('chorobutton');
        inflowmap.on('zoom', function() {
          if (inflowmap.getZoom() > zoomThreshold) {
            chorobuttonEl.style.display = 'none';
          } else {
            chorobuttonEl.style.display = 'block';
          }
        });
        

        });




    //OUTFLOW LOAD
    outflowmap.on('load', function () {


      var years = ['12','13','14','15','16','17']

       function setYear(year) {
                    // Set the label to the correct year
                    document.getElementById('year').textContent = years[year];

                    var pp = outflowmap.getPaintProperty('outflowMapLayer','fill-color');

                    console.log(pp);
                    pp.property = "outflow_" + years[year];

                    outflowmap.setPaintProperty('outflowMapLayer','fill-color',pp);

                    console.log(outflowmap.getPaintProperty('outflowMapLayer','fill-color'));

                    outflowmap.setLayoutProperty('outflowMapLayer', 'visibility', 'none');
                    outflowmap.setLayoutProperty('outflowMapLayer', 'visibility', 'visible');  
                  }


                  outflowmap.addLayer({
                    id: 'outflowMapLayer',
                    type: 'fill',
                    source: {
                      type: 'vector',
                url: 'mapbox://danzhang6028.9ok9uwzo' // Your Mapbox tileset Map ID
              },
            'source-layer': 'allyear_inoutflow-7ttqnz', // name of tilesets
            'minzoom':zoomThreshold,
            'layout': {
                // starting view
                'visibility': 'visible'
              },
              paint: {
                'fill-color': {
                  property: 'outflow_12',
                  stops:[
                  [0, '#e9dbc0'],
                  [1000, '#ceb075'],
                  [10000, '#a3803a'],
                  [20000, '#715928'],
                  [30000, '#3f3116'],
                  [40000, '#0d0a05'],]},
                  'fill-opacity': 1}
                },'settlement-label');


        //add border layer for hover effect
        outflowmap.addLayer({
          id: 'outflow-border',
          type: 'line',
          source: {
            type: 'vector',
                url: 'mapbox://danzhang6028.9p6p3l55' // Your Mapbox tileset Map ID
              },
            'source-layer': 'inflow_2017-a8wu8h', // name of tilesets
            'layout': {},
            'paint': {
              "line-color": "white",
              "line-width": 1
            }
          });


        //outflow map 
        outflowmap.addLayer({
          'id':'outflowline',
          'type':'line',
          'source':{
            'type': 'vector',
            'url':'mapbox://danzhang6028.bzc1xpnm' 
          },
          'source-layer':'outflow_lines_top10_withScotl-06lgoy',
          'maxzoom':zoomThreshold,
          'layout': {
            'visibility': 'visible'
          },
          'paint':{
            'line-opacity':0.28,
            'line-color': '#d1a771',
            'line-width':{
              property:'summed_mov',
              stops:[
              [4.824, 1],
              [500, 2],
              [911, 5],
              [1061,10],
              [1816.99, 15],]}  
            },
          });


        outflowmap.addLayer({
          id: 'outflow_destination',
          type: 'circle',
          source: {
            type: 'vector',
                      url: 'mapbox://danzhang6028.801i5p7y' // Your Mapbox tileset Map ID
                    },
                    'source-layer': 'outflow_destination_wihScol-altj6p', // name of tilesets
                    'maxzoom':zoomThreshold,
                    'layout': {
                      'visibility': 'visible'
                    },
                    paint: {
                      'circle-color': 'white',
                      'circle-opacity': 0.7,
                      'circle-radius': {
                            property: 'summed_mov',// add "1960" year data to the map
                            type:'exponential',
                            'stops': [
                            [5, 3], 
                            [6946, 13]]
                          }
                        }    
                      });


        outflowmap.addLayer({
          id: 'outflow_origination',
          type: 'circle',
          source: {
            type: 'vector',
                      url: 'mapbox://danzhang6028.7p66xs7s' // Your Mapbox tileset Map ID
                    },
                    'source-layer': 'OUTFLOW_RANK10-2ffxov', // name of tilesets
                    'maxzoom':zoomThreshold,
                    'layout': {
                      'visibility': 'visible'
                    },
                    paint: {
                      'circle-color': '#fbf88d',
                      'circle-opacity': 0.7,
                      'circle-radius': {
                        'base': 2,
                        'stops': [[0, 2], [8, 5]]
                      }
                    }    
                  });

        outflowmap.addLayer({
         id: 'outflow-border1',
         type: 'line',
         source: {
          type: 'vector',
                    url: 'mapbox://danzhang6028.9p6p3l55' // Your Mapbox tileset Map ID
                  },

              'source-layer': 'inflow_2017-a8wu8h', // name of tilesets
              'maxzoom':zoomThreshold,
              'layout': {},
              'paint': {
                'line-opacity':0.8,
                "line-color": "white",
                "line-width": 0.5
              }
            });


        var outflowLegendEl = document.getElementById('outflow-legend');
        outflowmap.on('zoom', function() {
          if (outflowmap.getZoom() > zoomThreshold) {
            outflowLegendEl.style.display = 'block';
          } else {
            outflowLegendEl.style.display = 'none';
          }
        });

        // ADD POPUP WINDOW 
        // origination popup window 
        var mypopup = new mapboxgl.Popup({closeButton: false}); 

        outflowmap.on('mouseover', 'outflow_destination', function (e) {
          mypopup
          .setLngLat(e.features[0].geometry.coordinates)
          .setHTML("<h2>" + e.features[0].properties.inflow_nam + "</h2>" 
           + '<p>' + 'Total Inflows: ' + e.features[0].properties.summed_mov +'</p>'
                                    ).addTo(outflowmap); // add table on popup box
        });
        outflowmap.on('mouseenter', 'outflow_destination', function () {
          outflowmap.getCanvas().style.cursor = 'pointer';
        });

                // Change it back to a pointer when it leaves and remove the popup window.
                outflowmap.on('mouseleave', 'outflow_destination', function () {
                  outflowmap.getCanvas().style.cursor = '';
                  mypopup.remove();
                });


        // destination popup window
        outflowmap.on('mouseover', 'outflow_origination', function (e) {
          mypopup
          .setLngLat(e.features[0].geometry.coordinates)
          .setHTML("<h2>" + e.features[0].properties.outflow_na + "</h2>" + "<table id = 'tablepop'><tr><th class = 'title'>Destination Rank</th><th>Rank1</th><th>Rank2</th><th>Rank3</th></tr><tr class = 'rate'><td class = 'title'>LA name</td><td>"+  e.features[0].properties['Rank1_name'] + "</td><td>" 
            +e.features[0].properties['Rank2_name'] +"</td><td>" 
            +e.features[0].properties['Rank3_name'] + "</td></tr><tr class = 'moves'><td class = 'title'>LA Moves</td><td>"+ 
            e.features[0].properties['Rank1_move'] + "</td><td>" 
            +e.features[0].properties['Rank2_move'] +"</td><td>" 
            +e.features[0].properties['Rank3_move'] + "</td></tr></table>"
                                    ).addTo(outflowmap); // add table on popup box
        });
        outflowmap.on('mouseenter', 'outflow_origination', function () {
          outflowmap.getCanvas().style.cursor = 'pointer';
        });

                // Change it back to a pointer when it leaves and remove the popup window.
                outflowmap.on('mouseleave', 'outflow_origination', function () {
                  outflowmap.getCanvas().style.cursor = '';
                  mypopup.remove();
                });



        // OUTFLOW MAP INFORMATION
        outflowmap.on('mousemove','outflowline', function(e) {

          var features = e.features

          if (features.length > 0) {
            document.getElementById('ph').innerHTML = '<h2>' + features[0].properties.outflow_na + '</h2><h3>to</h3>' + '<h2>'+ features[0].properties.inflow_nam +'</h2><p><strong><em>' +features[0].properties.summed_mov +'</strong> moves </em></p>';
          } else {
            document.getElementById('ph').innerHTML = '<p>Hover over a line!</p>';
          }
        });

        //outflowmap end


        document.getElementById('slider1').addEventListener('input', function(e) {
          var year = parseInt(e.target.value);
          setYear(year);
        });
        

        outflowmap.on('mousemove','outflowMapLayer', function(e) {
         var outfl = e.features

         if (outfl.length > 0) {
          document.getElementById('ph').innerHTML = '<h2><strong>' + outfl[0].properties.la_name + '</strong></h2><h3><strong><em>' + outfl[0].properties.outflow_12 + '</strong> people out in 2012 </br><strong>' + outfl[0].properties.outflow_13 + '</strong> people out in 2013</br><strong>'+ outfl[0].properties.outflow_14 +'</strong> people out in 2014</br><strong>'+ outfl[0].properties.outflow_15 +'</strong> people out in 2015</br><strong>'+ outfl[0].properties.outflow_16 +'</strong> people out in 2016</br><strong>'+ outfl[0].properties.outflow_17 +'</strong> people out in 2017</br><strong></em></h3>';
        } else {
          document.getElementById('ph').innerHTML = '<p>Hover over a borough!</p>';
        }

        outflowmap.setFilter("outflow-border", ["==", "la_name", outfl[0].properties.la_name]);

      }); 

        inflowmap.on("mouseleave",'InflowMapLayer', function () {
          inflowmap.setFilter("inflow-border", ["==", "la_name", ""]);
        });


        outflowmap.on("mouseleave",'outflowMapLayer', function () {
          outflowmap.setFilter("outflow-border", ["==", "la_name", ""]);
        });


        // show outflow map year based on zoom level
        var flowmapyearEl = document.getElementById('flowmapyear2');
        outflowmap.on('zoom', function() {
          if (outflowmap.getZoom() > zoomThreshold) {
            flowmapyearEl.style.display = 'none';
          } else {
            flowmapyearEl.style.display = 'block';
          }
        });

      });
                    
    //outflowmap.addControl(new mapboxgl.NavigationControl());
    </script>

    </body>
    </html>